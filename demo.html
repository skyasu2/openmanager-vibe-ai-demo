<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenManager 자연어 기반 서버 분석 데모</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <header class="app-header">
        <div class="logo">
            <i class="fas fa-server"></i>
            <h1>OpenManager <span>Vibe</span></h1>
        </div>
        <nav class="main-nav">
            <ul>
                <li><a href="index.html">홈</a></li>
                <li><a href="demo.html" class="active">자연어 분석 데모</a></li>
                <li><a href="#" class="disabled">설정</a></li>
                <li><a href="#" class="disabled">도움말</a></li>
            </ul>
        </nav>
    </header>
    
    <div class="container">
        <aside class="sidebar">
            <h2>필터</h2>
            <div class="filter-group">
                <h3>시간</h3>
                <select id="timeFilter">
                    <option value="all">모든 시간</option>
                    <option value="1h">1시간</option>
                    <option value="6h">6시간</option>
                    <option value="24h" selected>24시간</option>
                    <option value="7d">7일</option>
                </select>
            </div>
            <div class="filter-group">
                <h3>서버 유형</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="serverType" value="all" checked> 전체</label>
                    <label><input type="checkbox" name="serverType" value="web"> 웹 서버</label>
                    <label><input type="checkbox" name="serverType" value="database"> 데이터베이스</label>
                    <label><input type="checkbox" name="serverType" value="auth"> 인증 서버</label>
                    <label><input type="checkbox" name="serverType" value="cache"> 캐시 서버</label>
                </div>
            </div>
            <div class="filter-group">
                <h3>위치</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="location" value="all" checked> 전체</label>
                    <label><input type="checkbox" name="location" value="Seoul"> 서울</label>
                    <label><input type="checkbox" name="location" value="Busan"> 부산</label>
                    <label><input type="checkbox" name="location" value="Daejeon"> 대전</label>
                    <label><input type="checkbox" name="location" value="Jeju"> 제주</label>
                </div>
            </div>
            <div class="filter-group">
                <h3>상태</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" name="status" value="all" checked> 전체</label>
                    <label><input type="checkbox" name="status" value="normal"> 정상</label>
                    <label><input type="checkbox" name="status" value="warning"> 경고</label>
                    <label><input type="checkbox" name="status" value="critical"> 위험</label>
                </div>
            </div>
            <div class="filter-actions">
                <button id="resetFilters">필터 초기화</button>
            </div>
        </aside>
        
        <main class="main-content">
            <section class="search-section">
                <h2>자연어로 서버 분석하기</h2>
                <p class="description">일상적인 언어로 질문하면 AI가 서버 상태를 분석해 드립니다.</p>
                
                <div class="search-box">
                    <input type="text" id="queryInput" placeholder="예: CPU 사용률 높은 서버 찾아줘" autofocus>
                    <button id="searchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
                
                <div class="examples">
                    <p>예시 쿼리:</p>
                    <div class="example-chips">
                        <span class="chip" data-query="메모리 부족한 서버 알려줘">메모리 부족한 서버 알려줘</span>
                        <span class="chip" data-query="서울에 있는 서버 중 문제 있는 것">서울에 있는 서버 중 문제 있는 것</span>
                        <span class="chip" data-query="데이터베이스 서버 상태 확인">데이터베이스 서버 상태 확인</span>
                        <span class="chip" data-query="디스크 공간 부족한 서버">디스크 공간 부족한 서버</span>
                    </div>
                </div>
            </section>
            
            <section id="summary-section" class="summary-section hidden">
                <div class="summary-header">
                    <h2 id="summary-title">분석 결과</h2>
                    <div class="summary-actions">
                        <button id="downloadCSV" title="CSV 다운로드">
                            <i class="fas fa-download"></i> CSV
                        </button>
                    </div>
                </div>
                
                <div class="summary-content">
                    <p id="summary-description"></p>
                    
                    <div class="recommendations">
                        <h3>추천 사항</h3>
                        <ul id="recommendations-list"></ul>
                    </div>
                </div>
            </section>
            
            <section id="results-section" class="results-section hidden">
                <h2>서버 목록 (<span id="server-count">0</span>)</h2>
                
                <div class="server-grid" id="server-grid"></div>
            </section>
            
            <div id="empty-results" class="empty-results hidden">
                <i class="fas fa-search"></i>
                <h3>검색 결과가 없습니다</h3>
                <p>다른 검색어를 입력하거나 필터 설정을 확인해보세요.</p>
            </div>
        </main>
    </div>
    
    <template id="server-card-template">
        <div class="server-card">
            <div class="server-header">
                <div class="server-name"></div>
                <div class="server-status"></div>
            </div>
            <div class="server-info">
                <div class="info-item">
                    <span class="label">위치:</span>
                    <span class="location-value"></span>
                </div>
                <div class="info-item">
                    <span class="label">유형:</span>
                    <span class="type-value"></span>
                </div>
            </div>
            <div class="server-metrics">
                <div class="metric">
                    <div class="metric-name">CPU</div>
                    <div class="metric-bar">
                        <div class="bar-fill cpu-bar"></div>
                    </div>
                    <div class="metric-value cpu-value"></div>
                </div>
                <div class="metric">
                    <div class="metric-name">메모리</div>
                    <div class="metric-bar">
                        <div class="bar-fill memory-bar"></div>
                    </div>
                    <div class="metric-value memory-value"></div>
                </div>
                <div class="metric">
                    <div class="metric-name">디스크</div>
                    <div class="metric-bar">
                        <div class="bar-fill disk-bar"></div>
                    </div>
                    <div class="metric-value disk-value"></div>
                </div>
                <div class="metric">
                    <div class="metric-name">네트워크</div>
                    <div class="metric-bar">
                        <div class="bar-fill network-bar"></div>
                    </div>
                    <div class="metric-value network-value"></div>
                </div>
            </div>
        </div>
    </template>
    
    <footer class="app-footer">
        <p>&copy; 2025 OpenManager Vibe 데모 - AI 기반 자연어 서버 분석 기능</p>
    </footer>
    
    <script src="fixed_dummy_data.js"></script>
    <script src="data_processor.js"></script>
    <script src="summary.js"></script>
    <script>
        // 서버 데이터
        let allServers = [];
        let filteredServers = [];
        
        // DOM 로드 완료 후 초기화
        document.addEventListener('DOMContentLoaded', () => {
            // 더미 데이터 생성
            allServers = generateFixedServerData();
            filteredServers = [...allServers];
            
            // 이벤트 리스너 설정
            setupEventListeners();
        });
        
        // 이벤트 리스너 설정
        function setupEventListeners() {
            // 검색 버튼 클릭
            document.getElementById('searchButton').addEventListener('click', handleSearch);
            
            // 엔터 키 처리
            document.getElementById('queryInput').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    handleSearch();
                }
            });
            
            // 예시 쿼리 클릭
            document.querySelectorAll('.chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    document.getElementById('queryInput').value = chip.dataset.query;
                    handleSearch();
                });
            });
            
            // 필터 초기화
            document.getElementById('resetFilters').addEventListener('click', resetFilters);
            
            // 필터 변경 이벤트
            document.querySelectorAll('input[type="checkbox"], select').forEach(element => {
                element.addEventListener('change', applyFilters);
            });
            
            // CSV 다운로드
            document.getElementById('downloadCSV').addEventListener('click', downloadCSV);
        }
        
        // 검색 처리
        function handleSearch() {
            const query = document.getElementById('queryInput').value.trim();
            
            if (query === '') {
                alert('검색어를 입력해주세요.');
                return;
            }
            
            // 필터 적용된 서버에서 검색
            const filtered = filterServersByQuery(allServers, query);
            updateResults(filtered, query);
        }
        
        // 필터 초기화
        function resetFilters() {
            // 모든 체크박스 초기화
            document.querySelectorAll('.checkbox-group input[value="all"]').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            document.querySelectorAll('.checkbox-group input:not([value="all"])').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // 시간 필터 초기화
            document.getElementById('timeFilter').value = '24h';
            
            // 결과 업데이트
            applyFilters();
        }
        
        // 필터 적용
        function applyFilters() {
            // 기존 쿼리가 있으면 재검색
            const query = document.getElementById('queryInput').value.trim();
            if (query !== '') {
                handleSearch();
            }
        }
        
        // 결과 업데이트
        function updateResults(servers, query) {
            filteredServers = servers;
            
            // 요약 정보 생성
            const summary = generateSummaryFromQuery(query, filteredServers, allServers);
            updateSummarySection(summary);
            
            // 결과 섹션 표시 설정
            document.getElementById('summary-section').classList.remove('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            
            // 결과 수 업데이트
            document.getElementById('server-count').textContent = filteredServers.length;
            
            // 빈 결과 처리
            if (filteredServers.length === 0) {
                document.getElementById('results-section').classList.add('hidden');
                document.getElementById('empty-results').classList.remove('hidden');
            } else {
                document.getElementById('empty-results').classList.add('hidden');
                renderServerGrid(filteredServers);
            }
        }
        
        // 요약 섹션 업데이트
        function updateSummarySection(summary) {
            document.getElementById('summary-title').textContent = summary.title;
            document.getElementById('summary-description').textContent = summary.description;
            
            const recommendationsList = document.getElementById('recommendations-list');
            recommendationsList.innerHTML = '';
            
            summary.recommendations.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationsList.appendChild(li);
            });
        }
        
        // 서버 그리드 렌더링
        function renderServerGrid(servers) {
            const grid = document.getElementById('server-grid');
            grid.innerHTML = '';
            
            // 템플릿 가져오기
            const template = document.getElementById('server-card-template');
            
            // 각 서버에 대해 카드 생성
            servers.forEach(server => {
                const card = template.content.cloneNode(true);
                
                // 서버 기본 정보
                card.querySelector('.server-name').textContent = server.name;
                
                // 서버 상태
                const statusElement = card.querySelector('.server-status');
                statusElement.textContent = getStatusText(server.status);
                statusElement.classList.add(server.status);
                
                // 서버 정보
                card.querySelector('.location-value').textContent = server.location;
                card.querySelector('.type-value').textContent = getTypeText(server.type);
                
                // 메트릭 업데이트
                updateMetric(card, 'cpu', server.cpu);
                updateMetric(card, 'memory', server.memory);
                updateMetric(card, 'disk', server.disk);
                updateMetric(card, 'network', server.network);
                
                // 그리드에 추가
                grid.appendChild(card);
            });
        }
        
        // 메트릭 UI 업데이트
        function updateMetric(card, metricName, value) {
            const barFill = card.querySelector(`.${metricName}-bar`);
            const valueElement = card.querySelector(`.${metricName}-value`);
            
            barFill.style.width = `${value}%`;
            valueElement.textContent = `${value}%`;
            
            // 임계값에 따라 색상 설정
            if (value > 80) {
                barFill.classList.add('critical');
            } else if (value > 60) {
                barFill.classList.add('warning');
            } else {
                barFill.classList.add('normal');
            }
        }
        
        // 상태 텍스트 반환
        function getStatusText(status) {
            switch (status) {
                case 'normal': return '정상';
                case 'warning': return '경고';
                case 'critical': return '위험';
                default: return status;
            }
        }
        
        // 서버 유형 텍스트 반환
        function getTypeText(type) {
            switch (type) {
                case 'web': return '웹 서버';
                case 'database': return '데이터베이스';
                case 'auth': return '인증 서버';
                case 'cache': return '캐시 서버';
                default: return type;
            }
        }
        
        // CSV 다운로드
        function downloadCSV() {
            if (filteredServers.length === 0) {
                alert('다운로드할 데이터가 없습니다.');
                return;
            }
            
            const csvContent = convertToCSV(filteredServers);
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `server_data_${new Date().toISOString().slice(0, 10)}.csv`);
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>
</body>
</html> 